# TTSNewsReader Full-Stack Integration Guide

This guide walks you through setting up and running the complete TTSNewsReader system with both the iOS app and Node.js backend.

## Quick Start

### 1. Start the Backend Server
```bash
# From the project root directory
./start-backend.sh
```

### 2. Configure API Keys
Edit `backend/.env` with your credentials:
```env
INWORLD_API_KEY=your_actual_inworld_api_key
INWORLD_WORKSPACE_ID=your_workspace_id
INWORLD_SCENE_ID=your_scene_id
```

### 3. Test the Backend
```bash
cd backend
node test-api.js
```

### 4. Run the iOS App
1. Open `TTSNewsReader.xcodeproj` in Xcode
2. Update `Services/NewsService.swift` with your NewsAPI key
3. Build and run on simulator or device

## Backend API Endpoints

### Health Check
```http
GET http://localhost:3000/health
```

### Get Supported Voices
```http
GET http://localhost:3000/voices
```

### Generate TTS Audio
```http
POST http://localhost:3000/tts
Content-Type: application/json

{
  "text": "Hello, this is a news story...",
  "language": "en-US",
  "voice": "default"
}
```

## iOS App Integration

The iOS app's `TTSService.swift` has been updated to communicate with the backend:

```swift
// Instead of calling Inworld AI directly, the app now:
// 1. Sends POST request to http://localhost:3000/tts
// 2. Receives raw audio data (WAV format)
// 3. Plays audio using AVFoundation
```

### Key Changes Made

1. **Backend Communication**: `TTSService.swift` now calls the Node.js backend
2. **Error Handling**: Added backend-specific error cases
3. **Health Monitoring**: Added backend health check functionality
4. **Voice Management**: Added support for fetching voices from backend

## Testing the Integration

### 1. Backend Tests
```bash
cd backend
node test-api.js
```

### 2. Manual Testing
```bash
# Test TTS generation
curl -X POST http://localhost:3000/tts \
  -H "Content-Type: application/json" \
  -d '{"text":"Hello world","language":"en-US"}' \
  --output test.wav

# Play the generated audio (macOS)
afplay test.wav
```

### 3. iOS App Testing
1. Run the iOS app in Xcode
2. Ensure the backend is running on `localhost:3000`
3. Try playing news articles - audio should be generated by the backend

## Troubleshooting

### Backend Issues

**Server won't start:**
- Check if Node.js is installed: `node --version`
- Install dependencies: `cd backend && npm install`
- Check port availability: `lsof -i :3000`

**TTS generation fails:**
- Verify Inworld AI credentials in `.env`
- Check backend logs for error messages
- Test with the API test script: `node test-api.js`

**CORS errors:**
- Update `ALLOWED_ORIGINS` in `.env`
- Restart the backend server

### iOS App Issues

**Cannot connect to backend:**
- Ensure backend is running on `http://localhost:3000`
- Check iOS simulator network settings
- For physical device, update backend URL to your computer's IP

**Audio playback fails:**
- Check iOS audio session permissions
- Verify audio data is received from backend
- Check device volume and audio output

## Development Workflow

### 1. Backend Development
```bash
cd backend
npm run dev  # Auto-restart on changes
```

### 2. iOS Development
1. Keep backend running during iOS development
2. Use Xcode's console to monitor TTS requests
3. Test on both simulator and physical device

### 3. API Changes
1. Update backend endpoints as needed
2. Update iOS `TTSService.swift` accordingly
3. Run integration tests: `node test-api.js`

## Production Deployment

### Backend Deployment
1. Set `NODE_ENV=production` in environment
2. Configure production CORS origins
3. Use process manager like PM2
4. Set up proper logging and monitoring

### iOS App Store
1. Update backend URL to production server
2. Ensure all API keys are properly configured
3. Test thoroughly on physical devices

## Security Considerations

- API keys are stored in environment variables
- CORS is configured appropriately
- Request validation is implemented
- Error messages don't expose sensitive information

## Performance Optimization

- Audio caching can be implemented
- Request queuing for multiple TTS requests
- Connection pooling for better performance
